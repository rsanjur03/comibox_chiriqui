---
const pathname = Astro.url.pathname;
const isActive = (href: string) =>
  pathname === href || (href !== "/" && pathname.startsWith(href + "/"));
const linkCls = (href: string) =>
  isActive(href)
    ? "text-blue-400 font-semibold border-b-2 border-blue-400"
    : "text-gray-300 hover:text-blue-400";

const isAuthActive = (href: string) =>
  pathname === href ||
  (pathname.startsWith("/admin") && pathname.includes(href));
const authLinkCls = (href: string) =>
  isAuthActive(href)
    ? "text-blue-400 font-semibold border-b-2 border-blue-400 text-center"
    : "text-gray-400 hover:text-blue-400 text-center";

import logo from "../assets/comiboxch_logo.jpg";
---

<header class="bg-gray-900 border-b border-gray-700 print:hidden">
  <nav
    class="container mx-auto px-4 py-4 flex flex-col text-center md:flex-row md:justify-between md:items-center"
  >
    <div class="mb-2 md:mb-0 flex items-center justify-center">
      <a href="/" class="flex items-center space-x-2">
        <img
          src={logo.src}
          alt="Logo COMIBOX ChiriquÃ­"
          class="h-10 w-auto rounded-full"
        />
        <span class="text-2xl font-bold text-white">COMIBOX ChiriquÃ­</span>
      </a>
    </div>

    <!-- MENÃš PRINCIPAL -->
    <div
      class="flex flex-col space-y-2 md:flex-row md:space-y-0 md:space-x-6 items-center"
    >
      <a
        href="/"
        class={linkCls("/")}
        aria-current={isActive("/") ? "page" : undefined}
        >Inicio</a
      >

      <a
        href="/boxeadores"
        class={linkCls("/boxeadores")}
        aria-current={isActive("/boxeadores") ? "page" : undefined}
        >Boxeadores</a
      >

      <a
        href="/eventos"
        class={linkCls("/eventos")}
        aria-current={isActive("/eventos") ? "page" : undefined}
        >Eventos</a
      >

      <!-- âœ… NUEVO: VERIFICADOR PÃšBLICO -->
      <a
        href="/verificar-licencia"
        class={linkCls("/verificar-licencia")}
        aria-current={isActive("/verificar-licencia") ? "page" : undefined}
        >Verificar Licencia</a
      >

      <!-- ADMIN -->
      <a
        id="admin-link"
        href="/admin"
        class={isActive("/admin")
          ? "text-red-400 font-semibold"
          : "text-gray-400 hover:text-red-400 text-sm"}
        aria-current={isActive("/admin") ? "page" : undefined}
        >Admin</a
      >

      <button
        id="btn-logout"
        class="hidden text-gray-300 hover:text-red-400 text-sm"
        type="button"
        >Cerrar sesiÃ³n</button
      >
    </div>
  </nav>

  <!-- ======================
       MENÃš ADMIN DESPLEGABLE
       ====================== -->
  <div id="admin-nav" class="hidden container mx-auto px-4 pb-4">
    <nav
      class="bg-gray-800 rounded-lg shadow-md p-4 flex flex-wrap gap-2 items-center justify-center"
    >
      <!-- Dropdown GestiÃ³n -->
      <div class="relative group">
        <button
          class="flex items-center gap-1 px-4 py-2 text-gray-300 hover:text-blue-400 hover:bg-gray-700 rounded transition"
        >
          GestiÃ³n
          <svg
            class="w-4 h-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"></path>
          </svg>
        </button>
        <div
          class="hidden group-hover:block absolute left-0 top-full pt-2 w-64 z-50"
        >
          <div class="bg-gray-700 rounded-lg shadow-xl">
            <a
              href="/admin/boxeadores"
              class="block px-4 py-3 text-gray-300 hover:bg-gray-600 hover:text-blue-400 first:rounded-t-lg"
              >ğŸ“‹ Boxeadores</a
            >
            <a
              href="/admin/eventos"
              class="block px-4 py-3 text-gray-300 hover:bg-gray-600 hover:text-blue-400"
              >ğŸª Eventos</a
            >
            <a
              href="/admin/peleas"
              class="block px-4 py-3 text-gray-300 hover:bg-gray-600 hover:text-blue-400"
              >ğŸ¥Š Peleas</a
            >
            <a
              href="/admin/oficiales"
              class="block px-4 py-3 text-gray-300 hover:bg-gray-600 hover:text-blue-400"
              >ğŸ‘¨â€âš–ï¸ Oficiales</a
            >
            <a
              href="/admin/asignaciones"
              class="block px-4 py-3 text-gray-300 hover:bg-gray-600 hover:text-blue-400"
              >ğŸ“Œ AsignaciÃ³n de Oficiales</a
            >
            <a
              href="/admin/pesaje"
              class="block px-4 py-3 text-gray-300 hover:bg-gray-600 hover:text-blue-400"
              >âš–ï¸ Pesajes</a
            >

            <!-- âœ… NUEVO: CARNETS / LICENCIAS -->
            <a
              href="/admin/licencias"
              class="block px-4 py-3 text-gray-300 hover:bg-gray-600 hover:text-yellow-400"
              >ğŸªª Carnets / Licencias</a
            >

            <a
              href="/admin/finanzas"
              class="block px-4 py-3 text-gray-300 hover:bg-gray-600 hover:text-blue-400 last:rounded-b-lg"
              >ğŸ’° Finanzas</a
            >
          </div>
        </div>
      </div>

      <!-- Dropdown Reportes -->
      <div class="relative group">
        <button
          class="flex items-center gap-1 px-4 py-2 text-gray-300 hover:text-blue-400 hover:bg-gray-700 rounded transition"
        >
          Reportes
          <svg
            class="w-4 h-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 9l-7 7-7-7"></path>
          </svg>
        </button>
        <div
          class="hidden group-hover:block absolute left-0 top-full pt-2 w-64 z-50"
        >
          <div class="bg-gray-700 rounded-lg shadow-xl">
            <a
              href="/admin/reportes/pesaje"
              class="block px-4 py-3 text-gray-300 hover:bg-gray-600 hover:text-blue-400 first:rounded-t-lg"
              >ğŸ“Š Reporte de Pesaje</a
            >
            <a
              href="/admin/reportes/resultado"
              class="block px-4 py-3 text-gray-300 hover:bg-gray-600 hover:text-blue-400"
              >ğŸ† Reporte de Resultados</a
            >
            <a
              href="/admin/reportes/resumen"
              class="block px-4 py-3 text-gray-300 hover:bg-gray-600 hover:text-blue-400 last:rounded-b-lg"
              >ğŸ“‘ Reporte Resumen (Todos)</a
            >
          </div>
        </div>
      </div>
    </nav>
  </div>
</header>

<script type="module" src="/src/scripts/header-auth.js"></script>

<style>
  /* Asegurar que el dropdown sea visible y no se cierre al mover el mouse */
  .group:hover .group-hover\:block {
    display: block;
  }
</style>
