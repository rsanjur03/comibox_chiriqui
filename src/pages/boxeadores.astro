---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import BoxersHeader from '../components/BoxersHeader.astro';
import BoxersGrid from '../components/BoxersGrid.astro';
import BoxersTable from '../components/BoxersTable.astro';

import { db } from '../lib/firebase.js';
import { collection, getDocs, query, orderBy } from 'firebase/firestore';

type Boxer = {
  id: string;
  nombre: string;
  alias?: string;
  fotoURL?: string;
  victorias: number;
  derrotas: number;
  empates: number;
  victoriasKO?: number;
  derrotasKO?: number;
  provincia?: string;
  paisProcedencia?: string;
  guardia?: string;
  altura?: number;
  alcance?: number;
  fechaNacimiento?: string;
};

async function getBoxeadores(): Promise<Boxer[]> {
  const boxeadoresRef = collection(db, 'boxeadores');
  const q = query(boxeadoresRef, orderBy('nombre', 'asc'));
  const snapshot = await getDocs(q);
  return snapshot.docs.map(d => ({ id: d.id, ...(d.data() as any) }));
}

const boxeadores = await getBoxeadores();
---
<BaseLayout title="Boxeadores - COMIBOX ChiriquÃ­">
  <Header />
  <main class="grow container mx-auto p-4 md:p-8">
    <BoxersHeader activeView="lista" />
    <BoxersTable boxeadores={boxeadores} />
    <BoxersGrid boxeadores={boxeadores} />

    <script>
      const btnVistaLista = document.getElementById('btn-vista-lista');
      const btnVistaTarjetas = document.getElementById('btn-vista-tarjetas');
      const gridContainer = document.getElementById('lista-boxeadores-grid');
      const tablaContainer = document.getElementById('lista-boxeadores-tabla');

      if (btnVistaLista && btnVistaTarjetas && gridContainer && tablaContainer) {
        btnVistaLista.addEventListener('click', () => {
          tablaContainer.style.display = 'block';
          gridContainer.style.display = 'none';
          btnVistaLista.classList.add('bg-blue-600', 'text-white');
          btnVistaLista.classList.remove('bg-gray-700', 'text-gray-300', 'hover:bg-gray-600');
          btnVistaTarjetas.classList.add('bg-gray-700', 'text-gray-300', 'hover:bg-gray-600');
          btnVistaTarjetas.classList.remove('bg-blue-600', 'text-white');
        });
        btnVistaTarjetas.addEventListener('click', () => {
          tablaContainer.style.display = 'none';
          gridContainer.style.display = 'grid';
          btnVistaTarjetas.classList.add('bg-blue-600', 'text-white');
          btnVistaTarjetas.classList.remove('bg-gray-700', 'text-gray-300', 'hover:bg-gray-600');
          btnVistaLista.classList.add('bg-gray-700', 'text-gray-300', 'hover:bg-gray-600');
          btnVistaLista.classList.remove('bg-blue-600', 'text-white');
        });
      }
    </script>
  </main>
  <Footer />
</BaseLayout>