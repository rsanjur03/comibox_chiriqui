---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import EventsHeader from '../components/EventsHeader.astro';
import EventsGrid from '../components/EventsGrid.astro';

import { db } from '../lib/firebase.js';
import { collection, getDocs, query, orderBy } from 'firebase/firestore';

interface Evento {
  id: string;
  nombre: string;
  fecha: string;
  hora?: string;
  lugar?: string;
  ciudad?: string;
  provincia?: string;
  promotor?: string;
  flyerURL?: string;
}

async function getEventos(): Promise<Evento[]> {
  const eventosRef = collection(db, 'eventos');
  const q = query(eventosRef, orderBy('fecha', 'desc'));
  const snapshot = await getDocs(q);
  return snapshot.docs.map(d => ({ id: d.id, ...(d.data() as any) }));
}

const eventos = await getEventos();
---
<BaseLayout title="Eventos - COMIBOX ChiriquÃ­">
  <Header />
  <main class="container mx-auto p-4 md:p-8">
    <EventsHeader />
    <EventsGrid eventos={eventos} />
  </main>
  <Footer />
</BaseLayout>
