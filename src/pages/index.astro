---
// PARTE 1: CÓDIGO DEL SERVIDOR

// ¡NUEVA LÍNEA! Importamos el menú
import Nav from '../components/Nav.astro';

// Código existente
import { db } from '../lib/firebase.js';
import { collection, getDocs, query, where, orderBy } from 'firebase/firestore';

async function getEventos() {
  const hoy = new Date().toISOString().split('T')[0];
  const eventosRef = collection(db, "eventos");
  const q = query(eventosRef, where("fecha", ">=", hoy), orderBy("fecha", "asc"));
  const querySnapshot = await getDocs(q);
  return querySnapshot.docs.map(doc => ({
    id: doc.id,
    ...doc.data()
  }));
}

const eventos = await getEventos();
---

<html lang="es">
<head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <title>COMIBOX Chiriquí - Próximos Eventos</title>
</head>
<body class="bg-gray-100 min-h-screen">

    <Nav />

    <div class="container mx-auto p-8">
        <h2 class="text-3xl font-semibold text-gray-700 mb-6">Próximos Eventos</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">

            {eventos.length === 0 ? (
                <p class="text-gray-500 col-span-full">No hay eventos próximos registrados.</p>
            ) : (
                eventos.map(evento => (
                    <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                        <div class="p-6">
                            <h3 class="text-xl font-bold text-gray-800 mb-2">
    <a href={`/evento/${evento.id}`} class="text-blue-600 hover:underline">
        {evento.nombre}
    </a>
</h3>
                            <p class="text-gray-600 mb-1">
                                <strong>Fecha:</strong> {evento.fecha}
                            </p>
                            <p class="text-gray-600 mb-1">
                                <strong>Lugar:</strong> {evento.lugar}
                            </p>
                            <p class="text-gray-500 text-sm">
                                <strong>Promotor:</strong> {evento.promotor}
                            </p>
                        </div>
                    </div>
                ))
            )}
        </div>
    </div>
</body>
</html>